/*
  Test land is composed from:

  1) basic dirt (fractal + cracks + light)
  2) bulbs (random bunches in the basic dirt as height)
  2) rocks (random rocks)
  3) grass fields (from lines)
*/

// Target pixels dust pixel points
{
  name = grass_pixel_point
  type = MODIFICATOR_POINT_SINGLE

  color_table = /home/komat/Projekty/age_lib/hist/t4.jpg

  // Base dust background (from fractal generator)
  {
    type = MODIFICATOR_POINT_SINGLE_COLOR

    color_center = 3b5528

    color_delta_r = 0
    color_delta_g = 255
    color_delta_b = 0

    color_delta_parameter = PARAM_PREV_0
//    color_delta_parameter = PARAM_SCATTER

    final_operation = MODULATE
  }
}

// Target pixels dust pixel points
{
  name = dirt_pixel_point
  type = MODIFICATOR_POINT_SINGLE

  color_table = /home/komat/Projekty/age_lib/hist/t4.jpg

  // Base dust background (from fractal generator)
  {
    type = MODIFICATOR_POINT_SINGLE_COLOR

    color_center = 675851

    color_delta_r = 255
    color_delta_g = 255
    color_delta_b = 255

    //color_delta_parameter = PARAM_SCATTER
    color_delta_parameter = PARAM_PREV_0

    final_operation = MODULATE
  }
}

{
  name = dirt_field
  type = MODIFICATOR_FRACTAL
  modificator_slave = dirt_pixel_point
  fractal_hurst = 0.4
}

// Target pixels dist pixel points
{
  name = dirt_pixel_height
  type = MODIFICATOR_POINT_SINGLE
/*
  // Added dust height (from fractal generator)
  {
    type = MODIFICATOR_POINT_SINGLE_HEIGHT

    height_center = 0
    height_delta = 1

    height_operation = ADD
    height_parameter = PARAM_PREV_0
  }
*/
}

{
  name = dirt_field_height
  type = MODIFICATOR_FRACTAL
//  modificator_slave = dirt_pixel_height
  modificator_slave = dirt_pixel_point
  fractal_hurst = 0.4
  interpolation = LINE_MAX
}

{
  name = dirt_rect
  type = MODIFICATOR_RECT
  modificator_slave = dirt_pixel_point
}

// Target pixels - grass pixels
{
  name = grass_pixel_point
  type = MODIFICATOR_POINT_SINGLE

  // Base grass background (from fractal generator)
  {
   type = MODIFICATOR_POINT_SINGLE_COLOR

   color_max = 06bb00
   color_min = 000000 
   color_delta_parameter = PARAM_PREV_0

   final_blend = 1
   final_blend_parameter = PARAM_PREV_1
   final_operation = ADD
  }
}

// Target pixels - grass pixels
{
  name = grass_brown_pixel_point
  type = MODIFICATOR_POINT_SINGLE

  // Base grass background (from fractal generator)
  {
   type = MODIFICATOR_POINT_SINGLE_COLOR

   color_max = 6d6300
   color_min = 000000
   color_delta_parameter = PARAM_PREV_0

   final_blend = 1
   final_blend_parameter = PARAM_PREV_1
   final_operation = ADD
  }
}

// Target pixels - grass pixels
{
  name = grass_white_pixel_point
  type = MODIFICATOR_POINT_SINGLE

  // Base grass background (from fractal generator)
  {
   type = MODIFICATOR_POINT_SINGLE_COLOR

   color_max = bbbbbb
   color_min = 666666
   color_delta_parameter = PARAM_PREV_0
/*
   final_blend = 1
   final_blend_parameter = PARAM_PREV_1
   final_operation = ADD
*/
  }
}

// Target pixels - grass pixels
{
  name = grass_line
  type = MODIFICATOR_LINE
  modificator_slave = grass_pixel_point

  coordinates_random = 1 
  coordinates_random_num = 1 
  coordinates_operation = ADD 
  
  { 
    type = MODIFICATOR_COORDINATE 
 
    index = 0 
 
    start_x = 0 
    start_y = 0 
 
    size_x = 40 
    size_y = 40 
  }

  {
    type = MODIFICATOR_COORDINATE
    
    index = 1

    start_x = 40
    start_y = 40

    size_x = -40
    size_y = -40
  }
}

// Target pixels - grass pixels
{
  name = grass_brown_line
  type = MODIFICATOR_LINE
  modificator_slave = grass_brown_pixel_point

  coordinates_random = 1 
  coordinates_random_num = 1 
  coordinates_operation = ADD 
  
  { 
    type = MODIFICATOR_COORDINATE 
 
    index = 0 
 
    start_x = 0 
    start_y = 0 
 
    size_x = 40 
    size_y = 40 
  }

  {
    type = MODIFICATOR_COORDINATE
    
    index = 1

    start_x = 40
    start_y = 40

    size_x = -40
    size_y = -40
  }
}

// Target pixels - grass pixels
{
  name = grass_while_line
  type = MODIFICATOR_LINE
  modificator_slave = grass_white_pixel_point

  coordinates_random = 1 
  coordinates_random_num = 1 
  coordinates_operation = ADD 

  {
    type = MODIFICATOR_COORDINATE 

    index = 0 

    start_x = 0 
    start_y = 0 

    size_x = 40 
    size_y = 40 
  }

  {
    type = MODIFICATOR_COORDINATE

    index = 1

    start_x = 40
    start_y = 40

    size_x = -40
    size_y = -40
  }
}

{
  name = grass_fractal
  type = MODIFICATOR_FRACTAL
  modificator_slave = grass_line
  fractal_hurst = 0.2
  interpolation = MID_POINT
  height_range_min = 0.4
  pixel_step = 2
}

{
  name = grass_brown_fractal
  type = MODIFICATOR_FRACTAL
  modificator_slave = grass_brown_line
  fractal_hurst = 0.2
  interpolation = MID_POINT
  pixel_step = 2
}

{
  name = grass_white_fractal
  type = MODIFICATOR_FRACTAL
  modificator_slave = dirt_pixel_point
  fractal_hurst = 0.2
  heightmap_intensity=1
}


// Mesh generator
{
  name = forest_generator
  type = GENERATOR_MESH

  modificator = grass_white_fractal
  modificator_target = TEXTURE

/*
  modificator = land_light
  modificator_target = TEXTURE
*/
/*
  modificator = grass_white_fractal
  modificator_target = TEXTURE

  modificator = grass_brown_fractal
  modificator_target = TEXTURE

  modificator = grass_fractal
  modificator_target = TEXTURE
*/
}

// Test script
{
  name = test_mesh
  type = MESH_PARAMS

  size_x = 128
//  size_y = 128
  size_y = 64
  size_z = 128

  mesh_type = MESH_LAND
}

{
  name = test_material
  type = MATERIAL_PARAMS
}

{
  name = test_texture
  type = TEXTURE_PARAMS

//  texture_size_x = 512
//  texture_size_y = 512
  texture_size_x = 256
  texture_size_y = 256
  texture_height = 128

  background_color_r = 255
  background_color_g = 255
  background_color_b = 255
  background_color_a = 0
}

{
  name = generator_launcher
  type = GENERATOR_LAUNCHER

  generator_mesh = forest_generator
}
