// Target pixels dust pixel points
{
  name = dirt_pixel_point
  type = MODIFICATOR_POINT_SINGLE

  // Base dust background (from fractal generator)
  {
    type = MODIFICATOR_POINT_OPBOX

    color_center = #b29681
    color_center_scale = 2

    color_delta.r = rgb(50)
    color_delta.g = rgb(50)
    color_delta.b = rgb(50)
    
    pixel_color_final = color_center*color_center_scale + color_delta*PARAM_PREV_0
  }

  // Added dust noise (from random generator)
  {
    type = MODIFICATOR_POINT_OPBOX

    color_center = #b29681

    color_delta.r = rgb(50)
    color_delta.g = rgb(50)
    color_delta.b = rgb(50)
    
    pixel_color_final = pixel_color_final * (color_center + color_delta*PARAM_RAND)
  }
}

{
  name = dirt_field
  type = MODIFICATOR_FRACTAL
  modificator_slave = dirt_pixel_point
  fractal_hurst = 0.4
}

// Target pixels dist pixel points
{
  name = dirt_pixel_height
  type = MODIFICATOR_POINT_SINGLE

  // Added dust height (from fractal generator)
  {
    type = MODIFICATOR_POINT_OPBOX

    height_center = 0
    height_delta = 1
    
    pixel_height_final = pixel_height_final + (height_center + height_delta*PARAM_PREV_0)
  }
}

{
  name = dirt_field_height
  type = MODIFICATOR_FRACTAL
  modificator_slave = dirt_pixel_height
  fractal_hurst = 0.4
}

{
  name = dirt_field_height_repeated
  type = MODIFICATOR_HEIGHT_MAP
  modificator_slave = dirt_pixel_height
  height_source = TARGET_TEXTURE
  scale_target = 1
}

{
  name = land_light
  type = MODIFICATOR_LIGHT

  light_position.x =-1
  light_position.y = 1
  light_position.z =-1
}

// Mesh generator
{
  name = forest_generator
  type = GENERATOR_MESH

  modificator = dirt_field
  modificator_target = TEXTURE

  modificator = dirt_field_height
  modificator_target = TEXTURE

  modificator = dirt_field_height_repeated
  modificator_target = GEOMETRY

  modificator = land_light
  modificator_target = TEXTURE
}

// Test script
{
  name = test_mesh
  type = MESH_PARAMS

  size.x = 128
  size.y = 64
  size.z = 128

  mesh_type = MESH_LAND
}

{
  name = test_material
  type = MATERIAL_PARAMS
}

{
  name = test_texture
  type = TEXTURE_PARAMS

  texture_size.x = 512
  texture_size.y = 512
  texture_height = 128

  background_color.r = 255
  background_color.g = 255
  background_color.b = 255
  background_color.a = 0
}

{
  name = generator_launcher
  type = GENERATOR_LAUNCHER

  generator_mesh = forest_generator
}
